# Kali Linux latest with useful tools by tsumarios
FROM kalilinux/kali-rolling

# Set working directory to /root
WORKDIR /root

# Update
RUN apt -y update && DEBIAN_FRONTEND=noninteractive apt -y dist-upgrade && apt -y autoremove && apt clean

# Install common and useful tools
RUN apt -y install curl wget vim git net-tools whois netcat-traditional pciutils usbutils

# Install useful languages
RUN apt -y install python3-pip golang nodejs npm

# Install Kali Linux "Top 10" metapackage and a few cybersecurity useful tools
# NOTE: ltrace not found in apt -- why?
RUN DEBIAN_FRONTEND=noninteractive apt -y install kali-tools-top10 exploitdb man-db dirb nikto wpscan uniscan lsof apktool dex2jar strace binwalk wfuzz 

# Kiterunner needs to be pulled from Github and manually build.
# Write logic that resembles the documentation.
#
#https://github.com/assetnote/kiterunner
#
# Make sure to pop the wordlists and routes, too. They are noted in the
# README file as well.
RUN mkdir /build && \
    cd /build && \
    git clone https://github.com/assetnote/kiterunner && \
    cd kiterunner && \
    make build && \
    ln -s $(pwd)/dist/kr /usr/local/bin/kr && \
    wget https://wordlists-cdn.assetnote.io/data/kiterunner/routes-large.kite.tar.gz && \
    tar -xzf routes-large.kite.tar.gz && \
    cp routes-large.kite /root/routes-large.kite 

RUN cd /build && \
    git clone https://github.com/s0md3v/Arjun && \
    cd Arjun && \
    python3 setup.py install 

# Install Tor and proxychains, then configure proxychains with Tor
RUN apt -y install tor proxychains
COPY config/proxychains.conf /etc/proxychains.conf

# Install ZSH shell with custom settings and set it as default shell
RUN apt -y install zsh
RUN sh -c "$(curl -fsSL https://raw.github.com/ohmyzsh/ohmyzsh/master/tools/install.sh)"
COPY config/.zshrc .

ENTRYPOINT ["/bin/zsh"]